
; letterfall/kgtk.sscm - gtk and glib in a cps-wrapper
; Copyright (C) 2012 Alan Manuel K. Gloria
;
; This file is part of Letterfall.
;
; This program is free software; you can redistribute it and/or modify
; it under the terms of the GNU General Public License as published by
; the Free Software Foundation, either version 3 of the License, or
; (at your option) any later version.
;
; This program is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY, without even the implied warranty of
; MERCHANTIBILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
; GNU General Public License for more details.
;
; You should have received a copy of the GNU General Public License
; along with this program.  If not, see <http://www.gnu.org/licenses/>

define-module
  letterfall kgtk
  :export
  \\
    kgtk-start
    wait

use-modules
  ;
  oop goops
  ;
  gnome gobject
  gnome glib
  gnome gtk
  gnome gtk gdk-event
  ;
  letterfall kont

define toplevel-window #f
define drawing-area #f

define kgtk-start(title)
  kmonad-wrap $ lambda (pass)
    ;
    set! toplevel-window
      make <gtk-window>
        #:type \\ 'toplevel
        #:title \\ title
    set! drawing-area
      make <gtk-drawing-area>
    ;
    add toplevel-window drawing-area
    ;
    connect toplevel-window 'destroy
      lambda ___
        gtk-main-quit()
    ; TODO: connect keyboard event
    ;
    g-idle-add
      lambda ()
        pass '()
        #f ; don't repeat!
    ;
    show-all toplevel-window
    ;
    gtk-main()
    exit 0

define wait(ms)
  kmonad-wrap $ lambda (pass)
    g-timeout-add ms
      lambda ()
        pass '()
        #f ; disable timer
    '()

; vim: set ft=scheme : ;
